<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Ajax File Upload in Rails using Dropzone &amp; Carrierwave &#8211; Hacker's Journal</title>
<meta name="description" content="Asynchronously uploading files using dropzone.js + Carrierwave in Rails">
<meta name="keywords" content="ruby, rails, rails4, dropzone, dropzone.js, carrierwave, file upload, ajax, ajax file upload">
<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://sudharti.github.io/images/">
<meta name="twitter:title" content="Ajax File Upload in Rails using Dropzone &amp; Carrierwave">
<meta name="twitter:description" content="Asynchronously uploading files using dropzone.js + Carrierwave in Rails">
<meta name="twitter:creator" content="@sudharshan_iyer">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Ajax File Upload in Rails using Dropzone &amp; Carrierwave">
<meta property="og:description" content="Asynchronously uploading files using dropzone.js + Carrierwave in Rails">
<meta property="og:url" content="http://sudharti.github.io/articles/dropzone-rails">
<meta property="og:site_name" content="Hacker's Journal">

<!-- Webmaster Tools verfication -->
<meta name="google-site-verification" content="8hCr2mAx-864VaDr4RveyYeVznYWg0_PMy29V_ETJ1g">



<link rel="canonical" href="http://sudharti.github.io/articles/dropzone-rails">
<link href="http://sudharti.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="Hacker's Journal Feed">
<link rel="author" href="https://plus.google.com/110752291044075779531/?rel=author">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>
<!-- For all browsers -->
<link rel="stylesheet" href="http://sudharti.github.io/assets/css/main.min.css">

<!--[if (lt IE 9) & (!IEMobile)]>
<link rel="stylesheet" href="http://sudharti.github.io/assets/css/ie.min.css">
<![endif]-->

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://sudharti.github.io/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://sudharti.github.io/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://sudharti.github.io/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://sudharti.github.io/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://sudharti.github.io/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://sudharti.github.io/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://sudharti.github.io/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="article" itemscope itemtype="http://schema.org/WebPage">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="http://sudharti.github.io">Hacker's Journal</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement">
		    <ul>
		        
				<li><a href="http://sudharti.github.io/about/" >About</a></li>
		        
				<li><a href="/articles/" target="_blank">Articles</a></li>
		        
		        <li><i class="icon-feed"></i> <a href="http://sudharti.github.io/feed.xml" title="Atom/RSS feed">Feed</a>
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main" itemprop="mainContentOfPage" itemscope itemtype="http://schema.org/Blog">
  <div class="article-author-side">
    <img src="http://sudharti.github.io/images/sudharsanan.png" class="bio-photo" alt="Sudharsanan Muralidharan bio photo"></a>
<h3>Sudharsanan Muralidharan</h3>
<p>A Rubyist, Hacker, Blogger and Gadget Freak. Rails, Ember & Android</p>
<a href="http://github.com/sudharti" class="author-social" target="_blank"><i class="icon-github"></i> Github</a>
<a href="http://twitter.com/sudharshan_iyer" class="author-social" target="_blank"><i class="icon-twitter"></i> Twitter</a>
<a href="http://linkedin.com/in/sudharsananm" class="author-social" target="_blank"><i class="icon-linkedin"></i> LinkedIn</a>
<a href="http://facebook.com/sudharshan.muralidharan" class="author-social" target="_blank"><i class="icon-facebook"></i> Facebook</a>
<a href="https://plus.google.com/110752291044075779531/" class="author-social" target="_blank"><i class="icon-google-plus"></i> Google+</a>
<a href="http://instagram.com/sudhar_ti" class="author-social" target="_blank"><i class="icon-instagram"></i> Instagram</a>


  </div>
  <article itemscope itemtype="http://schema.org/BlogPosting" itemprop="blogPost">
    <div class="headline-wrap">
      <h1 itemprop="name">Ajax File Upload in Rails using Dropzone &amp; Carrierwave</h1>
      <h2></h2>
    </div><!--/ .headline-wrap -->
    <div class="article-wrap" itemprop="text">
      <figure class="first">
	<img src="/images/Dropzone.png" />
</figure>

<p><br />DropzoneJS is an open source library that provides drag’n’drop file uploads with image previews. For Rails you can use this gem <a href="https://github.com/ncuesta/dropzonejs-rails">dropzonejs-rails</a>. Add it to your Gemfile.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">gem</span> <span class="s1">&#39;dropzonejs-rails&#39;</span></code></pre></div>

<p>Add the following to application.js</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//= require dropzone</span></code></pre></div>

<p>Add the following to application.css</p>

<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="o">*=</span> <span class="nt">require</span> <span class="nt">dropzone</span><span class="o">/</span><span class="nt">dropzone</span></code></pre></div>

<p>Refer this <a href="http://www.dropzonejs.com/">http://www.dropzonejs.com/</a> to add dropzone to your form. Here is a typical example. </p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;/media-upload&quot;</span> <span class="na">class=</span><span class="s">&quot;dropzone&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;fallback&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;file&quot;</span> <span class="na">type=</span><span class="s">&quot;file&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/form&gt;</span></code></pre></div>

<h2 id="rails">Rails</h2>

<h3 id="add-carrierwave">Add Carrierwave</h3>
<p>If you are not already using carrierwave gem I recommend you add it right away. Carrierwave does all the work for you when it comes to File upload.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">gem</span> <span class="s1">&#39;carrierwave&#39;</span></code></pre></div>

<p>Refer this link for complete set of instructions <a href="https://github.com/carrierwaveuploader/carrierwave">Carrierwave</a></p>

<h3 id="media-uploader">Media Uploader</h3>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">rails</span> <span class="n">g</span> <span class="n">uploader</span> <span class="n">media</span></code></pre></div>

<h3 id="generate-new-model-for-media-content">Generate new Model for Media content</h3>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">rails</span> <span class="n">g</span> <span class="n">model</span> <span class="n">media</span> <span class="ss">file_name</span><span class="p">:</span><span class="n">string</span></code></pre></div>

<p><strong>models/media.rb</strong></p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Media</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">mount_uploader</span> <span class="ss">:file_name</span><span class="p">,</span> <span class="no">MediaUploader</span>
<span class="k">end</span></code></pre></div>

<h3 id="generate-new-controller">Generate new Controller</h3>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">rails</span> <span class="n">g</span> <span class="n">controller</span> <span class="n">media_contents</span></code></pre></div>

<p><strong>controllers/media_contents_controller.rb</strong></p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">MediaContentsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@media</span> <span class="o">=</span> <span class="no">Media</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">file_name</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:file</span><span class="o">]</span><span class="p">)</span>
    <span class="k">if</span> <span class="vi">@media</span><span class="o">.</span><span class="n">save!</span>
	  <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
	    <span class="nb">format</span><span class="o">.</span><span class="n">json</span><span class="p">{</span> <span class="n">render</span> <span class="ss">:json</span> <span class="o">=&gt;</span> <span class="vi">@media</span> <span class="p">}</span>
	  <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<h3 id="add-new-route">Add new route</h3>

<p><strong>config/routes.rb</strong></p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">resources</span> <span class="ss">:media_contents</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:create</span><span class="o">]</span></code></pre></div>

<h3 id="form">Form</h3>

<p>You can either use form_tag/form_for to generate the form or use plain html as given on dropzone’s website. Either of this will work just fine.</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;/media_contents&quot;</span> <span class="na">id=</span><span class="s">&quot;media-dropzone&quot;</span> <span class="na">class=</span><span class="s">&quot;dropzone&quot;</span> <span class="na">enctype=</span><span class="s">&quot;multipart/form-data&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;authenticity_token&quot;</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">value=</span><span class="s">&quot;&lt;%= form_authenticity_token %&gt;&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;fallback&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;media&quot;</span> <span class="na">type=</span><span class="s">&quot;file&quot;</span> <span class="na">multiple</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/form&gt;</span></code></pre></div>

<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">form_tag</span> <span class="s1">&#39;/media_contents&#39;</span><span class="p">,</span> <span class="nb">method</span><span class="p">:</span> <span class="ss">:post</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;dropzone&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">&quot;media-dropzone&quot;</span> <span class="k">do</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;div class=&quot;fallback&quot;&gt;</span>
<span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">file_field_tag</span> <span class="s2">&quot;media&quot;</span><span class="p">,</span> <span class="ss">multiple</span><span class="p">:</span> <span class="kp">true</span><span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span></code></pre></div>

<h2 id="handling-callbacks-using-javascript">Handling Callbacks using Javascript</h2>

<p>Once the form has been submitted the file is stored in specified directory. To get the file details and status we can manually pass data as json from the controller.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
   <span class="nb">format</span><span class="o">.</span><span class="n">json</span><span class="p">{</span> <span class="n">render</span> <span class="ss">:json</span> <span class="o">=&gt;</span> <span class="vi">@media</span> <span class="p">}</span>
<span class="k">end</span></code></pre></div>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">mediaDropzone</span><span class="p">;</span>
  <span class="nx">mediaDropzone</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dropzone</span><span class="p">(</span><span class="s2">&quot;#media-dropzone&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">mediaDropzone</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">responseText</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">imageUrl</span><span class="p">;</span>
    <span class="nx">imageUrl</span> <span class="o">=</span> <span class="nx">responseText</span><span class="p">.</span><span class="nx">file_name</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<p>You can also send additional parameters along with that Json from controller and access it in javascript. There are also plenty of options in Dropzone that you can tweak and fiddle around. Dropzone is an awesome plugin you shouldn’t miss. Happy Hacking!</p>

<p><br />
<a href="https://shrouded-beyond-2562.herokuapp.com/" class="btn" target="_blank">View Demo</a>
<a href="https://github.com/Just-hack/dropzone-sample" class="btn" target="_blank">Source on Github</a></p>

      <a href="https://twitter.com/share" class="twitter-share-button" data-lang="en">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
      <hr />
      <footer role="contentinfo">
        <div class="article-author-bottom">
          <img src="http://sudharti.github.io/images/sudharsanan.png" class="bio-photo" alt="Sudharsanan Muralidharan bio photo"></a>
<h3>Sudharsanan Muralidharan</h3>
<p>A Rubyist, Hacker, Blogger and Gadget Freak. Rails, Ember & Android</p>
<a href="http://github.com/sudharti" class="author-social" target="_blank"><i class="icon-github"></i> Github</a>
<a href="http://twitter.com/sudharshan_iyer" class="author-social" target="_blank"><i class="icon-twitter"></i> Twitter</a>
<a href="http://linkedin.com/in/sudharsananm" class="author-social" target="_blank"><i class="icon-linkedin"></i> LinkedIn</a>
<a href="http://facebook.com/sudharshan.muralidharan" class="author-social" target="_blank"><i class="icon-facebook"></i> Facebook</a>
<a href="https://plus.google.com/110752291044075779531/" class="author-social" target="_blank"><i class="icon-google-plus"></i> Google+</a>
<a href="http://instagram.com/sudhar_ti" class="author-social" target="_blank"><i class="icon-instagram"></i> Instagram</a>


        </div>
        <p class="byline"><strong>Ajax File Upload in Rails using Dropzone &amp; Carrierwave</strong> was published on <time datetime="2014-01-17T00:00:00-06:00" itemprop="datePublished">January 17, 2014</time> and last modified on <time datetime="2014-01-17" itemprop="dateModified">January 17, 2014</time> by <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name"><a href="http://sudharti.github.io/about" title="About Sudharsanan Muralidharan" itemprop="url">Sudharsanan Muralidharan</a></span></span>.</p>
      </footer>
      <div id="disqus_thread"></div>
          <script type="text/javascript">
              /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
              var disqus_shortname = 'sudhartigithubio'; // required: replace example with your forum shortname

              /* * * DON'T EDIT BELOW THIS LINE * * */
              (function() {
                  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </script>
      </div>
    </div><!-- /.article-wrap -->
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="http://sudharti.github.io/articles">View all articles</a>)</small></h4>
    <ul>
    
      
      
        
          
        
      
      
      <li><a href="http://sudharti.github.io/articles/ember-todo-firebase" title="Building a Todo app using ember.js &amp; firebase">Building a Todo app using ember.js &amp; firebase</a></li>
      
    
      
      
        
          
        
      
      
      <li><a href="http://sudharti.github.io/articles/async-mails-devise-sidekiq-rails" title="Sending Async Mail using Devise and Sidekiq">Sending Async Mail using Devise and Sidekiq</a></li>
      
    
      
      
        
          
        
      
      
      <li><a href="http://sudharti.github.io/articles/using-faker-and-populator-rails" title="Using Populator and Faker in Rails">Using Populator and Faker in Rails</a></li>
      
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  <footer>
    <span>&copy; 2015 Sudharsanan Muralidharan. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://sudharti.github.io/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://sudharti.github.io/assets/js/scripts.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl = 
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-47230802-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
	        

</body>
</html>
